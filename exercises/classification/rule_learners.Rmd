# Глава 5: Часть 1. Rule Learners

Классификация с использованием правил.

Алгоритм 1R 
Алгоритм RIPPER 

В чём отличие правил от деревьев решений --- правила могут пересматривать точку разделения в другом правиле. А дерево для этого создаст отдельную ветку.
По этой причине правила зачастую имеют дольшее время вычисления, но зато получаемые правила легче интерпретировать человеку.

## Справка

Алгоритм 1R --- выбирает одно наилучшее правило. Наилучшим считается то правило, у которого меньше коэффициент ошибки

Алгоритм RIPPER --- может создавать сложносоставные правила. Если хочется почитать, загугли.


## Шаг 1. Сбор данных

```{r}
library(tidyverse) # инструменты
library(OneR)      # алгоритм 1R
library(RWeka)     # алгоритм со сложными правила RIPPER
```

```{r}
mushrooms <- read.csv("source/Chapter05/mushrooms.csv", stringsAsFactors = TRUE)
```

Данные --- грибы

Что хотим --- научиться распознавать ядовитые грибы

## Шаг 2. Исследование и подготовка данных

Набор данных состоит только из категориальных фичей:

```{r}
mushrooms %>% glimpse()
```

Посмотрим на уровни каждой
```{r}
mushrooms %>% 
  as_tibble() %>% summary()
```

Переменная `veil_type` состоит только из одного признака. Она бесполезна для обучения, удалим её

```{r}
mushrooms$veil_type <- NULL
```

Теперь сама предсказываемая переменная:

```{r}
table(mushrooms$type)
```

Примерно поровну.

Важное ДОПУЩЕНИЕ --- мы предполагаем, что у эта выборка исчерпывающая. То есть других диких грибов не существует. Поэтому обучать и тестировать модель мы будем на одних и тех же данных. Звучит дико.

## Шаг 3. Обучение модели.

Попробуем сначала как с задачей справиться простейший алгоритм 1R

```{r}
mushroom_1R <- OneR(type ~ ., data = mushrooms)
```

Определяем по запаху, правило можно обобщить до --- если гриб неприятно пахнет, скорее всего он ядовит.

Воу. Справился этот пацан неплохо, почти 99% точность. Однако есть около 1% неправильно спрогнозированных грибов. Не беда если съедобный гриб спрогнозирован неправильно, но вот если ядовитый классифицирован неправильно, это может стоить жизни. Проверим

## Шаг 4. Оценка эффективности


```{r}
mushroom_1R_pred <- predict(mushroom_1R, mushrooms)
table(actual = mushrooms$type, predicted = mushroom_1R_pred)
```

Воу, картина удручающая. Алгоритм не распознал ни одного ядовитого гриба, хотя на самом деле это не так --- алгоритм пропусти 120 ядовитых грибов. Фатальная ошибка.

Но это ведь алгоритм, который использует только одно правило! Давайте попробуем добавить ещё правил.

## Шаг 5. Повышение эффективности модели

```{r}
mushroom_JRip <- JRip(type ~ ., data = mushrooms)
mushroom_JRip
summary(mushroom_JRip)
```

У нас выделено 9 правил, их можно представить в классической нотации программирования --- «если то».

Классификатор обеспечил 100% точность, невероятный результат.

Можно еще использовать алгоритм С5.0:

```{r}
mushroom_c5rules <- C50::C5.0(type ~ odor + gill_size, data = mushrooms, rules = TRUE)
summary(mushroom_c5rules)
```

